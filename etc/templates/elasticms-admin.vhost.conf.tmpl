# This VirtualHost is autogenerated by the container startup script
<VirtualHost *:9000>
    ServerName {{ .Env.SERVER_NAME }}

{{- if ne .Env.SERVER_ALIASES "" }}
    ServerAlias {{ .Env.SERVER_ALIASES }}
{{- end }}

    LimitRequestLine 16384

    # Uncomment the following line to force Apache to pass the Authorization
    # header to PHP: required for "basic_auth" under PHP-FPM and FastCGI
    #
    # SetEnvIfNoCase ^Authorization$ "(.+)" HTTP_AUTHORIZATION=$1

    # For Apache 2.4.9 or higher
    # Using SetHandler avoids issues with using ProxyPassMatch in combination
    # with mod_rewrite or mod_autoindex
    <FilesMatch \.php$>
        SetHandler "proxy:unix:/var/run/php-fpm/php-fpm.sock|fcgi://localhost/"
    </FilesMatch>

    DocumentRoot /opt/src/public
    <Directory /opt/src/public >
        AllowOverride None
        Order Allow,Deny
        Allow from All
        Require all granted
        FallbackResource /index.php
    </Directory>

    ErrorLog /dev/stderr
    CustomLog /dev/stdout common

    Header always append X-Frame-Options {{ .Env.APACHE_X_FRAME_OPTIONS }}
    Header always append X-XSS-Protection {{ .Env.APACHE_X_XSS_PROTECTION }}
    Header always append X-Content-Type-Options {{ .Env.APACHE_X_CONTENT_TYPE_OPTIONS }}

    RewriteEngine On
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

    Include /etc/apache2/conf.d/{{ env.Getenv "ELASTICMS_ADMIN_INSTANCE_NAME" }}/{{ env.Getenv "ELASTICMS_ADMIN_INSTANCE_NAME" }}.env.conf

</VirtualHost>